"use strict";(()=>{var e={};e.id=98,e.ids=[98],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6682:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>T,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>E,staticGenerationAsyncStorage:()=>c});var a={};t.r(a),t.d(a,{POST:()=>d});var i=t(9303),n=t(8716),s=t(670),o=t(7070),u=t(3720);async function d(e){try{let{serviceProviderId:r,rating:t}=await e.json();if(!r||!t)return o.NextResponse.json({error:"Service provider ID and rating are required"},{status:400});if("number"!=typeof t||t<1||t>5)return o.NextResponse.json({error:"Rating must be a number between 1 and 5"},{status:400});let a=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"unknown",i=e.headers.get("user-agent")||"unknown",n=await (0,u.jI)({service_provider_id:r,rating:t,ip_address:a,user_agent:i});return o.NextResponse.json({success:!0,id:n},{status:201})}catch(e){return console.error("Error adding rating:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/ratings/route",pathname:"/api/ratings",filename:"route",bundlePath:"app/api/ratings/route"},resolvedPagePath:"/Users/jonathanpolikowski/custom-ratings/app/api/ratings/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:c,serverHooks:E}=p,T="/api/ratings/route";function v(){return(0,s.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:c})}},3720:(e,r,t)=>{t.d(r,{jI:()=>u,kL:()=>d});let a=require("sqlite3");var i=t.n(a),n=t(6360);let s=null;async function o(){return s||(s=await (0,n.bA)({filename:"./ratings.db",driver:i().Database}),await s.exec(`
      CREATE TABLE IF NOT EXISTS ratings (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        service_provider_id TEXT NOT NULL,
        rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        ip_address TEXT,
        user_agent TEXT
      );

      CREATE INDEX IF NOT EXISTS idx_service_provider_id ON ratings(service_provider_id);
      CREATE INDEX IF NOT EXISTS idx_created_at ON ratings(created_at);
    `)),s}async function u(e){let r=await o();return(await r.run("INSERT INTO ratings (service_provider_id, rating, ip_address, user_agent) VALUES (?, ?, ?, ?)",[e.service_provider_id,e.rating,e.ip_address,e.user_agent])).lastID}async function d(e){let r=await o(),t=await r.get("SELECT AVG(rating) as average, COUNT(*) as count FROM ratings WHERE service_provider_id = ?",[e]);return{average:t?.average?Math.round(10*t.average)/10:0,count:t?.count||0}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,311],()=>t(6682));module.exports=a})();